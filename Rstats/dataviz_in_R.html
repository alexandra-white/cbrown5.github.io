<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">



<title></title>

<script src="dataviz_in_R_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="dataviz_in_R_files/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<link rel="stylesheet"
  media="screen and (max-width: 700px)"
  type="text/css" href="/css/narrow.css"/>

<link rel="stylesheet"
  media="screen and (min-width: 701px)"
  type="text/css" href="/css/screen.css"/>
<script src="dataviz_in_R_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="dataviz_in_R_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="dataviz_in_R_files/bootstrap-3.3.5/shim/respond.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; }
code > span.dt { color: #204a87; }
code > span.dv { color: #0000cf; }
code > span.bn { color: #0000cf; }
code > span.fl { color: #0000cf; }
code > span.ch { color: #4e9a06; }
code > span.st { color: #4e9a06; }
code > span.co { color: #8f5902; font-style: italic; }
code > span.ot { color: #8f5902; }
code > span.al { color: #ef2929; }
code > span.fu { color: #000000; }
code > span.er { font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



</head>

<body>
    <div id="banner_wrap">
        <div id="inner_banner">
        <img class = "banner_image" src = "/Images/fish_image.png">
        <h1> seascape models </h1>
        <p class="banner"> chris brown's blog on ocean science and quantitative ecology </p>
    </div>

    <div class="floatclear"></div>

    </div>
    <ul class = "menu">
          <a href ="/index.html"><li class = "menu_item">home</li></a>
          <a href ="/bluecology_blog/index.html"><li class = "menu_item">blog</li></a>
          <a href ="/Research/index.html#page_content"><li class = "menu_item">about</li></a>
          <a href ="https://scholar.google.com.au/citations?user=1qG6yFMAAAAJ&hl=en" target="_blank"><li class = "menu_item">publications</li></a>
          <a href ="/People/index.html#page_content"><li class = "menu_item">people</li></a>
          <a href ="/Rstats/index.html#page_content"><li class = "menu_item">code</li></a>
    </ul>
<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="dataviz_in_R_files/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



</div>


<div id="dataviz-in-r" class="section level2">
<h2>Dataviz in R</h2>
<p> These notes and code are intended to support my presentation for the <a href = http://bioinformatics.org.au/ws16/>Bioinformatics Winter School </a>at The University of Queensland, July 2016. </p>
<p> I hope you find them useful, whether you are able to attend or not. </p>
<div id="click-here-to-skip-to-my-quick-chart-quiz." class="section level3">
<h3><a href="/Rstats/dataviz_in_R.html#quickquiz">Click here to skip to my quick chart quiz</a></h3>
</div>
</div>
<div id="visualsing-sexual-dimorphism-in-elephant-seals" class="section level2">
<h2>Visualsing sexual dimorphism in elephant seals</h2>
<pre class="sourceCode r"><code class="sourceCode r">mnsize &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2800</span>, <span class="dv">650</span>)
sesize &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">800</span>, <span class="dv">50</span>)
nams &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span>)
cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;steelblue&#39;</span>, <span class="st">&#39;sienna3&#39;</span>)

<span class="kw">par</span>(<span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">2</span>))
<span class="kw">barplot</span>(mnsize, <span class="dt">names.arg =</span> <span class="st">&#39;&#39;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">ylab =</span> <span class="st">&#39;Weight (kg)&#39;</span>, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">cex.lab =</span><span class="dv">2</span>, <span class="dt">col =</span> cols)

<span class="kw">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="dt">legend =</span> nams, <span class="dt">pch =</span> <span class="dv">15</span>, <span class="dt">col =</span> cols, <span class="dt">cex =</span> <span class="dv">2</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-1-1.png" /><!-- --></p>
</div>
<div id="comparing-volume-and-area" class="section level2">
<h2>Comparing volume and area</h2>
<p>Compare these. Note that if we compare circles we should use area, not the radius or diameter to scale their size.</p>
<pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">5</span>)
<span class="kw">barplot</span>(n, <span class="dt">col =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">xaxt =</span> <span class="st">&#39;n&#39;</span>, <span class="dt">yaxt =</span> <span class="st">&#39;n&#39;</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-2-1.png" /><!-- --></p>
<pre class="sourceCode r"><code class="sourceCode r">rad1 &lt;-<span class="st"> </span><span class="dv">1</span>
area1 &lt;-<span class="st"> </span>pi*(rad1^<span class="dv">2</span>)
area2 &lt;-<span class="st"> </span>area1/<span class="dv">2</span>
rad2 &lt;-<span class="st"> </span><span class="kw">sqrt</span>(area2/pi)

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))
<span class="kw">pie</span>(<span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">labels =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">radius =</span> rad1)
<span class="kw">pie</span>(<span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">labels =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">radius =</span> rad2)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-2-2.png" /><!-- --></p>
</div>
<div id="exploration-of-data" class="section level2">
<h2>Exploration of data</h2>
<p>Let’s create a point cloud to demonstrate some data exploration techniques</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>)
x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>)
y &lt;-<span class="st"> </span><span class="dv">5</span>*x +<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">sd =</span> <span class="dv">15</span>)
<span class="kw">plot</span>(x,y, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">las =</span> <span class="dv">1</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-3-1.png" /><!-- --></p>
<p>Can’t see alot here. A linear model might help us explore if there is any trend going on:</p>
<pre class="sourceCode r"><code class="sourceCode r">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x)
<span class="kw">plot</span>(x,y, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">las =</span> <span class="dv">1</span>)
<span class="kw">abline</span>(mod1, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)

xnew &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(x), <span class="kw">max</span>(x), <span class="dt">length.out =</span> <span class="dv">100</span>)
pmod &lt;-<span class="st"> </span><span class="kw">predict</span>(mod1, <span class="dt">newdata =</span><span class="kw">data.frame</span>(<span class="dt">x=</span>xnew),  <span class="dt">se =</span> T)
<span class="kw">lines</span>(xnew, pmod$fit +<span class="st"> </span>pmod$se.fit, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">lines</span>(xnew, pmod$fit -<span class="st"> </span>pmod$se.fit, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-4-1.png" /><!-- --></p>
<p>What about identifying extreme points, that may be worth investigating further? We can pick out points that are greater than 2SDs from the trend:</p>
<pre class="sourceCode r"><code class="sourceCode r">modresid &lt;-<span class="st"> </span><span class="kw">resid</span>(mod1)
sd2 &lt;-<span class="st"> </span><span class="kw">sd</span>(modresid)*<span class="dv">2</span>
ipt &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">abs</span>(modresid) &gt;<span class="st"> </span>sd2)

<span class="kw">plot</span>(x,y, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">las =</span> <span class="dv">1</span>)
<span class="kw">abline</span>(mod1, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)

<span class="co">#Add points where residuals &gt; 2SD</span>
<span class="kw">points</span>(x[ipt], y[ipt], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>, <span class="fl">0.6</span>))</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-5-1.png" /><!-- --></p>
</div>
<div id="effect-size" class="section level2">
<h2>Effect size</h2>
<p>Lets compare two datasets that have similar p-values, but very different effect sizes</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>)
x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>)
<span class="kw">set.seed</span>(<span class="dv">420</span>)
y &lt;-<span class="st"> </span><span class="dv">5</span>*x +<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">sd =</span> <span class="dv">15</span>)
<span class="kw">set.seed</span>(<span class="dv">420</span>)
y2 &lt;-<span class="st"> </span><span class="dv">5</span>*x +<span class="st"> </span><span class="dv">3</span> +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">sd =</span> <span class="dv">1</span>)

mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x)
mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y2 ~<span class="st"> </span>x)

<span class="co">#Compare the pvalues on the slopes</span>
<span class="kw">summary</span>(mod1)</code></pre>
<pre><code>##
## Call:
## lm(formula = y ~ x)
##
## Residuals:
##     Min      1Q  Median      3Q     Max
## -43.201 -10.330   0.395   9.634  46.694
##
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)   2.8054     0.4614   6.080 1.71e-09 ***
## x             4.2096     0.4603   9.145  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
##
## Residual standard error: 14.59 on 998 degrees of freedom
## Multiple R-squared:  0.07732,    Adjusted R-squared:  0.07639
## F-statistic: 83.63 on 1 and 998 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mod2)</code></pre>
<pre><code>##
## Call:
## lm(formula = y2 ~ x)
##
## Residuals:
##      Min       1Q   Median       3Q      Max
## -2.88004 -0.68868  0.02634  0.64229  3.11291
##
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)  2.98703    0.03076   97.11   &lt;2e-16 ***
## x            4.94731    0.03069  161.21   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
##
## Residual standard error: 0.9724 on 998 degrees of freedom
## Multiple R-squared:  0.963,  Adjusted R-squared:  0.963
## F-statistic: 2.599e+04 on 1 and 998 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(x,y, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">las =</span> <span class="dv">1</span>)
<span class="kw">abline</span>(mod1, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)
<span class="kw">plot</span>(x,y2, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">las =</span> <span class="dv">1</span>)
<span class="kw">abline</span>(mod2, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-6-1.png" /><!-- --></p>
</div>
<div id="pie-graphs-vs-bar-graphs" class="section level2">
<h2>Pie graphs vs bar graphs</h2>
<p>In <a href ="http://onlinelibrary.wiley.com/doi/10.1890/150119/full">Mariani et al. </a> they plot rates of seafood fraud by several European countries. While its a foundational study that establishes improvement in the accuracy of food labelling, their graphics could be improved in several ways.</p>
<p>First they use perspective pies. This makes it incredibly hard to compare the two groups (fish that are labelled/mislabelled). Humans are very bad at comparing angles and pretty bad at comparing areas. With the perspective you can’t even compare the areas properly. They do provide the raw numbers, but then, why bother with the pies?<br />Note that the % pies misrepresent the data slightly because the % figures are actually odds ratios (mis-labels / correct labels), rather than percent (mis-labeels / total samples).<br />Second the pies are coloured red/green, which will be hard for red-green colourblind people to see.<br />Third, they have coloured land blue on their map, so it appears to be ocean at first look.<br />Fourth, the map is not really neccessary. There are no spatial patterns going on that the authors want to draw attention to. I guess having a map does emphasize that the study is in Europe. Finally, the size of each pie is scaled to the sample size, but the scale bar for the sample size shows a sample of only 30, whereas most of their data are for much larger samples sizes (&gt;200). Do you get the impression from the pies that the UK has 668 samples, whereas Ireland only has 187? Therefore, from this graphic we have no idea what sample size was used in each country.</p>
<p>In fact, all the numbers that are difficult to interpret in the figure are very nicely presented in Table 1.</p>
<p>Below is a start at improving the presentation. For instance, you could do a simple bar chart, ordering by rate of mislabelling.</p>
<pre class="sourceCode r"><code class="sourceCode r">cnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Ireland&#39;</span> ,<span class="st">&#39;UK&#39;</span>,<span class="st">&#39;Germany&#39;</span>,<span class="st">&#39;France&#39;</span>,<span class="st">&#39;Spain&#39;</span>,<span class="st">&#39;Portugal&#39;</span>)
corrlab &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">180</span>, <span class="dv">647</span>, <span class="dv">145</span>, <span class="dv">146</span>, <span class="dv">267</span>, <span class="dv">178</span>)
mislab &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">21</span>, <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">24</span>, <span class="dv">12</span>)
misrate &lt;-<span class="st"> </span><span class="dv">100</span>*<span class="kw">signif</span>(mislab /<span class="st"> </span>(corrlab +<span class="st"> </span>mislab),<span class="dv">2</span>)
corrrate &lt;-<span class="st"> </span><span class="dv">100</span> -<span class="st"> </span>misrate
ord &lt;-<span class="st"> </span><span class="kw">order</span>(misrate, <span class="dt">decreasing =</span> T)
y &lt;-<span class="st"> </span><span class="kw">rbind</span>(corrrate, misrate)


<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">7</span>))
<span class="kw">barplot</span>(y[,ord], <span class="dt">names.arg =</span> cnames[ord], <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;skyblue&#39;</span>,<span class="st">&#39;tomato&#39;</span>), <span class="dt">ylab =</span> <span class="st">&#39;Labelling rate (%)&#39;</span>, <span class="dt">las =</span> <span class="dv">2</span>)
<span class="kw">legend</span>(<span class="dt">x=</span><span class="fl">7.5</span>, <span class="dt">y =</span> <span class="dv">90</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Mislabelled&quot;</span>, <span class="st">&quot;Correctly labelled&quot;</span>), <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;tomato&#39;</span>,<span class="st">&#39;skyblue&#39;</span>), <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="fl">0.7</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-7-1.png" /><!-- --></p>
<p>You could add another subfigure to this, showing the rate by different species too.</p>
<p>The barplot doesn’t communicate the sample size, but then that is probably not the main point. The sample sizes are probably best reported in the table</p>
<p>If we felt the map was essential, then putting barcharts on it would be more informative. It is not that easy to add barcharts ontop of an existing map in R, so I would recommend creating the barcharts seperately, then adding them on in Illustrator or Powerpoint.</p>
<p>We can make a basic map like this:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maps)</code></pre>
<pre><code>##
##  # maps v3.1: updated &#39;world&#39;: all lakes moved to separate new #
##  # &#39;lakes&#39; database. Type &#39;?world&#39; or &#39;news(package=&quot;maps&quot;)&#39;.  #</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maptools)</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Checking rgeos availability: TRUE</code></pre>
<pre><code>##
## Attaching package: &#39;maptools&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:sp&#39;:
##
##     nowrapSpatialLines</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="st">&#39;world&#39;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(-<span class="dv">20</span>, <span class="dv">20</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">35</span>, <span class="dv">60</span>), <span class="dt">col =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">fill =</span> T)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-8-1.png" /><!-- --></p>
<p>Then create some nice barcharts. We write a loop so we get one barchart for each country.</p>
<pre class="sourceCode r"><code class="sourceCode r">nc &lt;-<span class="st"> </span><span class="kw">length</span>(cnames)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>))
for (i in <span class="dv">1</span>:nc){
  y &lt;-<span class="st"> </span><span class="kw">c</span>(mislab[i], corrlab[i])
  <span class="kw">barplot</span>(y, <span class="dt">names.arg =</span> <span class="st">&#39;&#39;</span>, <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;tomato&#39;</span>,<span class="st">&#39;skyblue&#39;</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, corrlab[i]), <span class="dt">main =</span> cnames[i], <span class="dt">cex.main =</span> <span class="fl">2.4</span>, <span class="dt">yaxt =</span> <span class="st">&#39;n&#39;</span>)
  byy &lt;-<span class="st"> </span><span class="kw">signif</span>(<span class="kw">max</span>(y),<span class="dv">2</span>)/<span class="dv">3</span>
  yat &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">min</span>(y), <span class="kw">max</span>(y))
<span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> yat, <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">labels =</span> F)
<span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> yat[<span class="dv">2</span>:<span class="dv">3</span>], <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">labels =</span> T)
}
<span class="kw">legend</span>(<span class="dt">x =</span> <span class="fl">2.8</span>, <span class="dt">y =</span> <span class="dv">500</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;Fraud&#39;</span>, <span class="st">&#39;Correct&#39;</span>), <span class="dt">pch =</span> <span class="dv">15</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;tomato&#39;</span>,<span class="st">&#39;skyblue&#39;</span>), <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>, <span class="dt">bty =</span> <span class="st">&#39;n&#39;</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-9-1.png" /><!-- --></p>
</div>
<div id="choosing-axes" class="section level2">
<h2>Choosing axes</h2>
<p>It can be misleading to present % and proportion data on axes that are not scaled 0 - 100%. For instance, compare these three graphs:</p>
<pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">70</span>, <span class="dv">72</span>, <span class="dv">68</span>, <span class="dv">73</span>)
x &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">4</span>
xnams &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span>:<span class="dv">4</span>]

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(x,y, <span class="dt">pch =</span> <span class="dv">3</span>, <span class="dt">cex =</span> <span class="dv">2</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">xaxt  =</span> <span class="st">&#39;n&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Percent&#39;</span>, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">cex.lab =</span> <span class="dv">2</span>, <span class="dt">tcl =</span> <span class="fl">0.5</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> x, <span class="dt">labels =</span> xnams, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">tcl =</span> <span class="fl">0.5</span>)

<span class="kw">barplot</span>(y, <span class="dt">names.arg =</span> xnams, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">cex.lab =</span> <span class="dv">2</span>, <span class="dt">cex.names =</span> <span class="dv">2</span>, <span class="dt">ylab =</span> <span class="st">&#39;Percent&#39;</span>)

<span class="kw">barplot</span>(y, <span class="dt">names.arg =</span> xnams, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">cex.lab =</span> <span class="dv">2</span>, <span class="dt">cex.names =</span> <span class="dv">2</span>, <span class="dt">ylab =</span> <span class="st">&#39;Percent&#39;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-10-1.png" /><!-- --></p>
</div>
<div id="choosing-colour-scales" class="section level2">
<h2>Choosing colour scales</h2>
<p>Alot of thought should go into choosing colour scales for graphs for instance- will it print ok? will colour blind people be able to see this? does the scale create artificial visual breaks in the data? Luckily there is a package to help you make the right decision for a colour scale, it is called <code>RColorBrewer</code>. Check out colorbrewer.org for a helpful interactive web interface for choosing colours.<br />Here I recreate the map of that in Cinner et al. 2016 Nature for fish biomass (using dummy data, as I don’t have their data).</p>
<p>First let’s specify some dummy data</p>
<pre class="sourceCode r"><code class="sourceCode r">fishbio &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">3.2</span>, <span class="fl">3.3</span>, <span class="fl">3.4</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="fl">3.7</span>,<span class="fl">3.9</span>,<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">4</span>)
longs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">95.59062</span> ,<span class="fl">96.50676</span>,<span class="fl">121.05892</span>,<span class="fl">128.14529</span>,<span class="fl">135.00157</span>,<span class="fl">166.68020</span>,<span class="fl">156.44645</span>,<span class="fl">146.75308</span>, <span class="fl">150.8980</span>, <span class="fl">151.1395</span>, <span class="fl">142.9253</span>, <span class="fl">119.0074</span>)
lats &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">4.3201110</span>,<span class="fl">1.9012211</span>, -<span class="fl">7.4197367</span>,  <span class="fl">0.4173821</span> , <span class="fl">7.2730141</span>, -<span class="fl">19.8772305</span>, -<span class="fl">28.3750059</span>, -<span class="fl">16.9918706</span>, -<span class="fl">21.985131</span>,  -<span class="fl">9.422199</span>,  -<span class="fl">2.899138</span>,   <span class="fl">1.932759</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RColorBrewer)
<span class="kw">library</span>(maps)

<span class="co">#Create the colours for locations</span>
cols &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;RdYlGn&#39;</span>)
colsf &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(cols)
cols100 &lt;-<span class="st"> </span><span class="kw">colsf</span>(<span class="dv">100</span>)
breaks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(fishbio)-<span class="fl">0.01</span>, <span class="kw">max</span>(fishbio)+<span class="fl">0.01</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)
icol &lt;-<span class="st"> </span><span class="kw">cut</span>(fishbio, <span class="dt">breaks =</span> breaks, <span class="dt">labels =</span> F)
fishcols &lt;-<span class="st"> </span>cols100[icol]

<span class="co">#Plot locations</span>
<span class="kw">map</span>(<span class="st">&#39;world&#39;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">80</span>, <span class="dv">180</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(-<span class="dv">35</span>, <span class="dv">35</span>),<span class="dt">interior =</span> F, <span class="dt">fill =</span> T, <span class="dt">col =</span> <span class="st">&#39;grey&#39;</span>)
<span class="kw">points</span>(longs, lats, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> fishcols, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">points</span>(longs, lats, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-12-1.png" /><!-- --></p>
<p>Using red-green palettes makes it hard for colour blind people. Also, using a diverging palette makes it look like there is something important about the middle point (yellow). A better palette to use would be one of the sequential ones. Using reds (and reversing it using <code>rev()</code>) emphasises the worst places. We could use greens and emphasise the best places too. I am using a light grey for the fill so that the points stand out more.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Create sequential colours for locations</span>
cols &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Reds&#39;</span>))
colsf &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(cols)
cols100 &lt;-<span class="st"> </span><span class="kw">colsf</span>(<span class="dv">100</span>)
breaks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(fishbio)-<span class="fl">0.01</span>, <span class="kw">max</span>(fishbio)+<span class="fl">0.01</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)
icol &lt;-<span class="st"> </span><span class="kw">cut</span>(fishbio, <span class="dt">breaks =</span> breaks, <span class="dt">labels =</span> F)
fishcols &lt;-<span class="st"> </span>cols100[icol]

<span class="co">#Plot locations</span>
<span class="kw">map</span>(<span class="st">&#39;world&#39;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">80</span>, <span class="dv">180</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(-<span class="dv">35</span>, <span class="dv">35</span>),<span class="dt">interior =</span> F, <span class="dt">fill =</span> T, <span class="dt">col =</span> <span class="st">&#39;grey90&#39;</span>)
<span class="kw">points</span>(longs, lats, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> fishcols, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">points</span>(longs, lats, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-13-1.png" /><!-- --></p>
<p>To make it easier to understand, let’s look at these again as contour plots. I will use a more appropriate diverging palette to the red-green one though.</p>
<pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dv">10</span>), <span class="dt">nrow =</span> <span class="dv">10</span>)
<span class="kw">filled.contour</span>(z, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Reds&#39;</span>), <span class="dt">nlevels =</span> <span class="dv">10</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-14-1.png" /><!-- --></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filled.contour</span>(z, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;RdBu&#39;</span>), <span class="dt">nlevels =</span> <span class="dv">10</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-14-2.png" /><!-- --></p>
<p>Notice the diverging pallette creates an artificial split at yellow</p>
<p>One of the only legitimate uses for pie graphs (I think) is visualising the colour scales. Here is how:</p>
<pre class="sourceCode r"><code class="sourceCode r">reds &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Reds&#39;</span>)
greens &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Greens&#39;</span>)
blues &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Blues&#39;</span>)
rdylgn &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;RdYlGn&#39;</span>)
rdbu &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;RdBu&#39;</span>)
dark2 &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&#39;Dark2&#39;</span>)

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))
<span class="kw">pie</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">9</span>), <span class="dt">col =</span> reds)
<span class="kw">pie</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">9</span>), <span class="dt">col =</span> greens)
<span class="kw">pie</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">9</span>), <span class="dt">col =</span> blues)
<span class="kw">pie</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">9</span>), <span class="dt">col =</span> rdylgn)
<span class="kw">pie</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">9</span>), <span class="dt">col =</span> rdbu)
<span class="kw">pie</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">9</span>), <span class="dt">col =</span> dark2)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-15-1.png" /><!-- --></p>
</div>
<div id="interpreting-rates" class="section level2">
<h2>Interpreting rates</h2>
<p>People are bad at interpreting rates, we just can’t get our heads around accumulation very well. Here is a numerical example. Check out the below figure and ask yourself:</p>
<blockquote>
    <div id="quickquiz"></div>
<p>At what time is the number of people in the shopping centre declining?</p>
</blockquote>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-16-1.png" /><!-- --></p>
<p>Before you proceed with code below, take the poll:</p>
<iframe src="http://www.strawpoll.me/embed_1/10667920" style="width:600px;height:390px;border:0;">
<p>Loading poll…</iframe></p>
<p>Here is how we made the figure and generated the data:</p>
<p>Would you say it is at point A, B, C or D?</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="fl">4.5</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">0</span>))
<span class="kw">plot</span>(times, inrate_err, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;Hour of day&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;People per 10 minutes&#39;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">&#39;darkblue&#39;</span>, <span class="dt">cex.lab =</span> <span class="dv">2</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">12</span>))
<span class="kw">lines</span>(times, outrate_err, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">&#39;tomato&#39;</span>)

<span class="kw">abline</span>(<span class="dt">v =</span> <span class="dv">12</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))
<span class="kw">text</span>(<span class="dv">12</span>, <span class="dv">13</span>, <span class="st">&#39;A&#39;</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="fl">13.5</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))
<span class="kw">text</span>(<span class="fl">13.5</span>, <span class="dv">13</span>, <span class="st">&#39;B&#39;</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="fl">14.2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))
<span class="kw">text</span>(<span class="fl">14.2</span>, <span class="dv">13</span>, <span class="st">&#39;C&#39;</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="fl">15.8</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))
<span class="kw">text</span>(<span class="fl">15.8</span>, <span class="dv">13</span>, <span class="st">&#39;D&#39;</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>)

<span class="kw">legend</span>(<span class="st">&#39;bottomleft&#39;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&#39;Entering&#39;</span>, <span class="st">&#39;Leaving&#39;</span>), <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&#39;darkblue&#39;</span>,<span class="st">&#39;tomato&#39;</span>), <span class="dt">cex =</span> <span class="fl">1.5</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-18-1.png" /><!-- --></p>
<p>Let’s plot the total number of people:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="fl">5.5</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">0</span>))
<span class="kw">plot</span>(times, <span class="kw">cumsum</span>(inrate_err) -<span class="st"> </span><span class="kw">cumsum</span>(outrate_err), <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;Hour of day&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;People in shopping centre&#39;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">cex.axis =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">&#39;darkblue&#39;</span>, <span class="dt">cex.lab =</span> <span class="dv">2</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">120</span>))


<span class="kw">abline</span>(<span class="dt">v =</span> <span class="dv">12</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))
<span class="kw">text</span>(<span class="dv">12</span>, <span class="dv">130</span>, <span class="st">&#39;A&#39;</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="fl">13.5</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))
<span class="kw">text</span>(<span class="fl">13.5</span>, <span class="dv">130</span>, <span class="st">&#39;B&#39;</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="fl">14.1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;tomato&#39;</span>)
<span class="kw">text</span>(<span class="fl">14.2</span>, <span class="dv">130</span>, <span class="st">&#39;C&#39;</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="fl">15.8</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>))
<span class="kw">text</span>(<span class="fl">15.8</span>, <span class="dv">130</span>, <span class="st">&#39;D&#39;</span>, <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-19-1.png" /><!-- --></p>
</div>
<div id="anatomy-of-a-simple-chart" class="section level2">
<h2>Anatomy of a simple chart</h2>
<p>The construction of a simple chart in R can be a surprisingly long piece of code. Here is an example to get you started. Don’t be afraid to experiment!</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># --------------- #</span>
<span class="co"># Make some data</span>
<span class="co"># --------------- #</span>
<span class="kw">set.seed</span>(<span class="dv">42</span>)

n &lt;-<span class="st"> </span><span class="dv">11</span>

x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="kw">seq</span>(<span class="dv">18</span>, <span class="dv">25</span>, <span class="dt">length.out =</span> n))
y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span><span class="kw">seq</span>(<span class="dv">26</span>, <span class="dv">18</span>, <span class="dt">length.out =</span> n))
z &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">22</span>)
t &lt;-<span class="st"> </span><span class="dv">2005</span>:(<span class="dv">2005</span>+n<span class="dv">-1</span>)

datnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Almonds&#39;</span>, <span class="st">&#39;Peanuts&#39;</span>, <span class="st">&#39;Hazelnuts&#39;</span>)


<span class="kw">plot</span>(t, x)
<span class="kw">lines</span>(t, y)
<span class="kw">lines</span>(t, z)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-20-1.png" /><!-- --></p>
<p>Which look terrible. Let’s build a better chart.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Package for colours</span>
<span class="kw">library</span>(RColorBrewer)

<span class="co">#Set axis limits</span>
ymax &lt;-<span class="st"> </span><span class="dv">30</span>
ylim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, ymax)
xlim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">min</span>(t), <span class="kw">max</span>(t))

<span class="co">#Define colours</span>
cols &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&#39;Dark2&#39;</span>)

<span class="co">#Parameters for plotting</span>
lwd &lt;-<span class="st"> </span><span class="dv">2</span>
xlabels &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(t), <span class="kw">max</span>(t), <span class="dt">by =</span> <span class="dv">5</span>)
ylabels &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, ymax, <span class="dt">by =</span> <span class="dv">5</span>)

<span class="co">#Set the window params</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>))

<span class="co">#Build the plot</span>
<span class="kw">plot</span>(t, x, <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">bty =</span> <span class="st">&#39;n&#39;</span>, <span class="dt">xaxt =</span> <span class="st">&#39;n&#39;</span>, <span class="dt">yaxt =</span> <span class="st">&#39;n&#39;</span>,
 <span class="dt">ylim =</span> ylim, <span class="dt">xlim =</span> xlim, <span class="dt">lwd =</span> lwd, <span class="dt">col =</span> cols[<span class="dv">1</span>],
  <span class="dt">xaxs =</span> <span class="st">&#39;i&#39;</span>, <span class="dt">yaxs =</span> <span class="st">&#39;i&#39;</span>,
  <span class="dt">xlab =</span> <span class="st">&#39;Time (yrs)&#39;</span>,
  <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>,
  <span class="dt">main =</span> <span class="st">&#39;Changing price of nuts ($/kg)&#39;</span>)

<span class="co">#Add more lines</span>
<span class="kw">lines</span>(t, y, <span class="dt">lwd =</span> lwd, <span class="dt">col =</span> cols[<span class="dv">2</span>])
<span class="kw">lines</span>(t, z, <span class="dt">lwd =</span> lwd, <span class="dt">col =</span> cols[<span class="dv">3</span>])

<span class="co">#Add labels to lines</span>
<span class="kw">text</span>(t[n], x[n], datnames[<span class="dv">1</span>], <span class="dt">adj =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">col =</span> cols[<span class="dv">1</span>])
<span class="kw">text</span>(t[n], y[n], datnames[<span class="dv">2</span>], <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">adj =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">col =</span> cols[<span class="dv">2</span>])
<span class="kw">text</span>(t[n], z[n], datnames[<span class="dv">3</span>], <span class="dt">xpd =</span> <span class="ot">NA</span>, <span class="dt">adj =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">col =</span> cols[<span class="dv">3</span>])

<span class="co"># Add custom axes</span>
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&#39;white&#39;</span>, <span class="dt">col.ticks =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">labels =</span> xlabels, <span class="dt">at =</span> xlabels)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&#39;white&#39;</span>, <span class="dt">col.ticks =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">labels =</span> <span class="ot">NA</span>, <span class="dt">at =</span> t)

<span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;white&#39;</span>, <span class="dt">col.ticks =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">las =</span><span class="dv">1</span>, <span class="dt">labels =</span> ylabels, <span class="dt">at =</span> ylabels)</code></pre>
<p><img src="dataviz_in_R_files/figure-html/unnamed-chunk-21-1.png" /><!-- --></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
